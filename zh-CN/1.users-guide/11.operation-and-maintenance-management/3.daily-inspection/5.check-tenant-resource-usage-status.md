检查租户资源使用状态
===============================

您可以通过 OCP 或 SQL 命令的方式来检查租户资源使用状态。

通过 OCP 查看租户资源的使用情况
---------------------------------------

>**说明**
>
>不同 OCP 版本的操作界面可能不同，本节以 OCP V3.1.1 版本为例提供操作指导，OCP 其他版本的操作请参考对应版本的《 OCP 用户指南》文档。

可通过 OCP 查看租户的资源负载情况。操作步骤如下：

1. 登录 OCP，在左侧导航栏，单击 **租户** 。

2. 在 **租户概览** 页面的 **租户列表** 区域，选择待操作的租户并单击其租户名。

3. 在显示的页面的左侧导航栏上，单击 **资源管理** 。

   ![2日常巡检-检查租户资源负载](http://icms-x-dita.oss-cn-zhangjiakou.aliyuncs.com/xdita-output/zh-CN/task14795230/images/p310404.png?Expires=7258145942&OSSAccessKeyId=LTAIJfoPL6wmrirR&Signature=IRS7mPX%2B0rdRA%2BSo4gZ6%2Fo96J4Q%3D)

   配置功能项描述如下表所示：

   |               参数               |                                                                                                                            说明                                                                                                                            |
   |--------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
   | 条件范围                           | *选择按 **数据库** 进行筛选，筛选条件可以为选择数据库、表或分区。确定筛选条件后，单击 **查询** ，即可在 **资源使用趋势** 和 **排行榜** 区域查看信息。* 选择按 **表组** 进行筛选，选则全部表组或某一表组，选择全部表或某一表，选择全部分区或某一分区。确定筛选条件后，单击 **查询** 。    |
   | 资源使用趋势                         | 查看 **磁盘、分区副本、CPU** 和 **内存** 的趋势图。                                                                                                                                                                                                                        |
   | 磁盘和分区副本                        | 展示资源使用情况的趋势。                                                                                                                                                                                                                                             |
   | CPU 和 内存                       | 展示资源分配情况的趋势。                                                                                                                                                                                                                                             |
   | 筛选图标或 Zone3 / Zone2 / Zone1 图标 | 单击每个趋势图的筛选图标或 Zone3 / Zone2 / Zone1 图标，可分别查看不同 Zone 的资源水位。                                                                                                                                                                                               |

通过 SQL 命令查看租户资源的使用情况
-----------------------------------------

您可执行以下命令，查看租户资源的使用情况。

```sql
obclient> SELECT t1.tenant_name,concat(svr_ip,":",svr_port) as "unit_server",t3.max_cpu,t3.min_cpu,round(t3.max_memory/1024/1024/1024,1) as "max_memory(G)" ,round(t3.min_memory/1024/1024/1024,1) as "min_memory(G)"  FROM __all_tenant t1,__all_unit t2,__all_unit_config t3,__all_resource_pool t4
where t1.tenant_id = t4.tenant_id
AND t4.resource_pool_id=t2.resource_pool_id 
AND t4.unit_config_id=t3.unit_config_id
ORDER BY t1.tenant_name
+---------------+----------------+---------+---------+---------------+---------------+
| tenant_name   | unit_server    | max_cpu | min_cpu | max_memory(G) | min_memory(G) |
+---------------+----------------+---------+---------+---------------+---------------+
| sys           |  10.0.0.0:7702 |       5 |     2.5 |           7.5 |           6.3 |
| tenant_mysql  |  10.0.0.0:7702 |       2 |       2 |           5.0 |           5.0 |
+---------------+--------------------+---------+---------+---------------+---------------+
```

字段说明如下。

|     字段      |           说明           |
|-------------|------------------------|
| tenant_name | 租户名                    |
| unit_server | 租户 unit 所在的 OBServer   |
| max_cpu     | 租户 unit 允许使用的最大 CPU 核数 |
| min_cpu     | 租户 unit 至少可使用的 CPU 核数  |
| max_memory  | 租户 unit 允许使用的最大内存      |
| min_memory  | 租户 unit 至少可使用的内存       |
