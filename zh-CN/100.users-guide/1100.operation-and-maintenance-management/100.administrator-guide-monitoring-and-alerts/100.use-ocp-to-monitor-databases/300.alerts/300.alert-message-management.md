# 告警消息管理

OCP 对告警消息的管理主要包括：告警事件、告警消息通知记录、告警屏蔽和日志过滤。

* **告警事件** ：当某集群处于异常状态，导致用户收到大量告警消息时，如需要对其中部分指定告警项进行查看和统计，可通过告警事件进行管理。

* **告警通知** ：为您提供 90 天内的通知记录查看，超过 90 天的通知记录将会自动归档。

* **告警屏蔽** ：实际生产过程中，当集群出现异常引发告警时，某些导致告警的已知问题可能需要较长时间才能恢复解决，为避免消息打扰，这时可使用告警界面中"告警屏蔽"页签中屏蔽告警的功能，对具体告警项进行短时间屏蔽。

* **日志过滤** ：由于 OceanBase 数据库为分布式数据库，故存在三类不同的类型日志，包括 election 选举日志、 rootservice 管控服务日志、 observer 运行日志。OceanBase 数据库日志告警不基于告警规则触发，实现原理是在 OceanBase 数据库服务器节点上监视三种日志，发现 ERROR 级别的日志则触发告警。由于物理机环境及不同节点上系统环境千差万别，如果用户发现有 ERROR 级别日志误报的情况，可以在 **OB 日志过滤** 页面配置日志过滤规则。

## 查看告警事件

1. 登录 OCP。

2. 在左侧导航栏中单击 **系统管理** **\>** **告警** 。

3. 单击 **告警事件** 进入该页签中。

   展开查询框，设置查询条件，如：需要查询 OCP 所有服务器上级别为严重且在告警中的应用告警，则可如图设置并单击 **查询** 按钮。![111](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/3829060261/p271210.png)告警事件列表中将返回所有符合条件的告警事件。

4. 在告警事件列表点击某条告警，进入告警事件 **详情** 页。

   **详情** 页中可查看到告警产生的相关信息和该告警通知记录。

   ![05121002](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/7747870261/p272715.png)

5. 在告警事件详情页中单击 **查看告警项** 。

   系统显示该告警事件的告警规则。

   ![05121008](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/7747870261/p272717.png)

6. 在告警事件详情页中单击 **屏蔽告警** 。

   在屏蔽告警对话框中设置屏蔽该告警事件的 **结束时间** ，并单击 **确定** 。

   则该告警在结束时间前将不会再上报。

   ![050802](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/3829060261/p271715.png)

## 查看告警通知

1. 登录 OCP。

2. 在左侧导航栏中单击 **系统管理** **\>** **告警** 。

3. 单击 **通知消息记录** 进入该页签中。

4. 展开查询框并输入查询条件，然后单击 **查询** 按钮。

    ![Image 3](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/3729060261/p271223.png)系统将在查询框下方列表中返回所有符合条件的告警通知记录。

   >**说明**
   >
   >录入查询条件时应知：
   >
   >* 来源：默认为 **OB 告警** ，可切换为 **应用告警** 。
   >
   >* 接收人：默认为当前登录用户，如需查看群消息通道发送的告警，可配置为 **全部** 。
   >
   >* 如需查看通知涉及的告警信息，可在返回结果中单击通知记录前的 **+** 符号。

   * 如需屏蔽该告警，可在返回结果中单击消息记录 **操作** 列的 **屏蔽告警** 。

     在 **屏蔽告警** 对话框中配置屏蔽告警的 **结束时间** ，则在结束时间前该告警将不会再上报。

     >**说明**
     >
     >只有 **消息形式** 为 **单条** 时，才可执行 **屏蔽告警** 操作。

## 屏蔽告警

在 **告警事件** 和 **通知消息记录** 页签中可以快速屏蔽告警，但只能屏蔽已上报的告警，且只能规定屏蔽时间，屏蔽的灵活度不够。

以下所示的屏蔽方法可灵活地设置屏蔽条件，将用户不想关注的告警提早屏蔽。屏蔽条件新建好后，系统将会依照屏蔽条件对告警进行屏蔽，若没有立刻执行屏蔽，则建议多等 30 秒。

执行 OceanBase 集群的运维任务时，运维任务会自动设置告警屏蔽。

1. 登录 OCP。

2. 在左侧导航栏中选择 **系统管理** **\>** **告警** 。

3. 在屏蔽告警页签中单击 **新建屏蔽条件** 。

4. 在 **新建屏蔽条件** 的对话框中配置屏蔽条件。

   |  屏蔽条件  |                                                                                                                  配置说明                                                                                                                  |
   |--------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
   | 来源     | <ul><li>OB：告警来源为 OB。</li> <li>应用：告警来源为其他应用，如 OCP、OBProxy 等。</li></ul>                                                                                                    |
   | 集群/应用  | 根据来源的选择而展示不同的界面词： <ul><li>来源选择 **OB** 时显示集群，选择待屏蔽的 OceanBase 集群。</li> <li>来源选择 **应用** 时显示应用，需选择待屏蔽的应用。若选择的应用为 OBProxy，还需要选择要屏蔽的 OBProxy 集群。</li></ul>    |
   | 屏蔽范围   | 依据实际需要，选择屏蔽的范围是全部、租户还是服务器。选项的显示根据前两个参数的配置而有不同。                                                                                                                                                                                         |
   | 租户/服务器 | **屏蔽范围** 选择 **租户** 时，界面显示为租户，选择需要屏蔽告警的租户。 **屏蔽范围** 选择 **服务器** 时，界面显示为服务器，选择需要屏蔽告警的服务器。                                                                                                                                 |
   | 屏蔽告警项  | 选择需要屏蔽的告警，可多选。                                                                                                                                                                                                                         |
   | 结束时间   | 配置告警屏蔽的结束时间。在结束时间前，被屏蔽的告警不会上报。<ul><li>可单击方框内自定义结束时间。</li> <li>也可单击方框后的时间，如单击 **6 小时** ，系统会将当前时间 + 6 小时填充到方框中。 </li></ul>                                |

   ![002](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/0799970261/p271363.png)

## 过滤日志

您可以在 OCP 上为 OceanBase 数据库日志添加过滤关键字，以便上报告警时可忽略带关键字的日志记录。

>**说明**
>
>OceanBase 数据库的日志告警不是基于告警规则触发，其实现原理是监视 OceanBase 服务器上的日志，发现有 Error 级别的日志则触发告警。但有时 Error 级别的日志并非问题，此时可以添加过滤关键字，以便告警上报时忽略带有该关键字的 Error 级别的日志。

1. 登录 OCP。

2. 在左侧导航栏中选择 **系统管理** **\>** **告警** 。

3. 在 **OB 日志过滤** 页签中单击 **添加过滤关键字** 。

   系统弹出 **添加过滤关键字** 的对话框。

4. 根据实际需求配置过滤条件。

   ![004](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/2629060261/p271498.png)

    **关键字** 支持正则表达式。匹配该关键字的日志内容不会触发告警。

5. 单击 **确定** 。