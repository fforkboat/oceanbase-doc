检查集群资源使用状态
===============================

通过 OCP 查看集群资源的使用情况
---------------------------------------

>**说明**
>
>不同 OCP 版本的操作界面可能不同，本节以 OCP V3.1.1 版本为例提供操作指导，OCP 其他版本的操作请参考对应版本的《 OCP 用户指南》文档。

可通过 OCP 查看集群的资源负载情况。操作步骤如下：

1. 登录 OCP，进入 **集群概览** 主页面。

2. 在 **集群概览** 页面的 **集群列表** 区域，单击要查询的 **集群名** 。

3. 在显示的页面的左侧导航栏上，单击 **资源管理** 。![resource](http://icms-x-dita.oss-cn-zhangjiakou.aliyuncs.com/xdita-output/zh-CN/task14795230/images/p377891.png?Expires=7258145942&OSSAccessKeyId=LTAIJfoPL6wmrirR&Signature=qmd5KYunD28d3jDO4JFZahHqJVc%3D)

   配置功能项描述如下表所示：

   |               参数               |                                                                                                                            说明                                                                                                                            |
   |--------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
   | 条件范围                           | *选择按 **数据库** 进行筛选，筛选条件可以为选择数据库、表或分区。确定筛选条件后，单击 **查询** ，即可在 **资源使用趋势** 和 **排行榜** 区域查看信息。* 选择按 **表组** 进行筛选，选则全部表组或某一表组，选择全部表或某一表，选择全部分区或某一分区。确定筛选条件后，单击 **查询** 。    |
   | 资源使用趋势                         | 查看 **磁盘、分区副本、CPU** 和 **内存** 的趋势图。                                                                                                                                                                                                                        |
   | 磁盘和分区副本                        | 展示资源使用情况的趋势。                                                                                                                                                                                                                                             |
   | CPU 和 内存                       | 展示资源分配情况的趋势。对于 CPU 的负载，建议最高阈值不超过 80%；对于内存的负载，建议最高阈值不超过 90%。                                                                                                                                                                                              |
   | 筛选图标或 Zone3 / Zone2 / Zone1 图标 | 单击每个趋势图的筛选图标或 Zone3 / Zone2 / Zone1 图标，可分别查看不同 Zone 的资源水位。                                                                                                                                                                                               |

通过 SQL 命令查看集群资源的使用情况
-----------------------------------------

您可使用 sys 租户登录， 执行以下命令，查看集群资源的使用情况。

```sql
ob-sys 10.0.0.0 (root@oceanbase)>  SELECT t1.svr_ip, t1.svr_port, t1.zone, t2.with_rootserver, t1.cpu_total, t1.cpu_assigned cpu_ass, t1.cpu_assigned_percent cpu_ass_pct, round(t1.mem_total/1024/1024/1024,1) "mem_total(G)", round(t1.mem_assigned/1024/1024/1024,1) "mem_ass(G)", t1.mem_assigned_percent mem_ass_pct, t1.unit_num  FROM __all_virtual_server_stat t1 JOIN __all_server t2 ON (t1.svr_ip=t2.svr_ip) ORDER BY zone;
+----------+----------+-------+-----------------+-----------+---------+-------------+--------------+------------+-------------+----------+
| svr_ip   | svr_port | zone  | with_rootserver | cpu_total | cpu_ass | cpu_ass_pct | mem_total(G) | mem_ass(G) | mem_ass_pct | unit_num |
+----------+----------+-------+-----------------+-----------+---------+-------------+--------------+------------+-------------+----------+
| 10.0.0.0 |     7702 | zone1 |               1 |        22 |     8.5 |          38 |         25.1 |       21.3 |          84 |        3 |
| 10.0.0.0 |     7702 | zone2 |               0 |        22 |     8.5 |          38 |         25.1 |       21.3 |          84 |        3 |
| 10.0.0.0 |     7702 | zone3 |               0 |        22 |     8.5 |          38 |         25.1 |       21.3 |          84 |        3 |
+---------------+----------+-------+-----------------+-----------+---------+-------------+--------------+------------+-------------+----------+
3 rows in set (0.02 sec)
```

字段说明如下。

|          字段          |                                                                          说明                                                                          |
|----------------------|------------------------------------------------------------------------------------------------------------------------------------------------------|
| svr_ip               | OBServer 所在服务器 IP                                                                                                                                    |
| svr_port             | 进程端口号                                                                                                                                                |
| zone                 | OBServer 所在的 zone                                                                                                                                    |
| with_rootserver      | *如果为 1，说明 OBServer 提供 RS 服务。* 如果为 0，说明 OBServer 不提供 RS 服务。    |
| cpu_total            | OBServer 总 CPU 资源                                                                                                                                    |
| cpu_ass              | OBServer 已分配 CPU 资源                                                                                                                                  |
| cpu_ass_pct          | OBServer 已分配 CPU 资源占总资源百分比                                                                                                                           |
| mem_total            | OBServer 总内存资源                                                                                                                                       |
| mem_ass              | OBServer 已分配内存资源                                                                                                                                     |
| mem_ass_pct:observer | 已分配内存资源占总资源百分比                                                                                                                                       |
| unit_num             | OBServer 的 unit 数量                                                                                                                                   |
