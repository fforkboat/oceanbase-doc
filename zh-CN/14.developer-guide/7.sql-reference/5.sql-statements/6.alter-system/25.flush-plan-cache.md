# FLUSH PLAN CACHE

该语句用来清除指定 Database 和 SQL ID 的计划缓存。

## 语法

```sql
ALTER SYSTEM FLUSH PLAN CACHE
 [SQL_identifier] [database_list] [tenant_list ] [GLOBAL];

database_list:
databases ='database_name, database_name...'
tenant_list:
     tenant = 'tenant_name, tenant_name….'
```

## 参数解释

| 参数 | 描述 |
| --- | --- |
| SQL_identifier | 用于指定 SQL，格式为 `sql_id = 'xxx'`。如果不指定该参数，表示清空所有 SQL 的计划缓存。<blockquote>**说明** </br> sql_id 可以通过如下方式获得：`select * from oceanbase.gv$plan_cache_plan_stat where statement = 'select * from test_1203 where id = ?' order by tenant_id;` </blockquote> |
| database_list | 用于指定 Database。如果不指定该参数，表示清除所有计划缓存。 |
| tenant_list | 用于指定租户范围。指定 SQL_identifier 和 database_list 参数时一定要指定 tenant_list，将操作限定在租户范围内。</br>**说明**</br>只有系统租户 sys 才能指定 tenant_list，其他租户不能指定该参数，即其他租户只能清除自己的计划缓存。如果系统租户不指定 tenant_list 则表示清除所有租户的计划缓存。 |
| GLOBAL | 为可选字段。如果不指定该参数，表示清空本机的计划缓存。反之，则表示清空该租户所在的所有服务器上的计划缓存。 |

## 示例

- 清除所有计划缓存。
  
     ```sql
     obclient> ALTER SYSTEM FLUSH PLAN CACHE;
     Query OK, 0 rows affected
     ```

     >**说明**
     >
     >在 sys 系统租户中，该语句代表清除所有计划缓存；在普通租户下，代表清除当前租户下所有计划缓存。

- 清除指定租户计划缓存。

     ```sql
     obclient> ALTER SYSTEM FLUSH PLAN CACHE TENANT = 'MySQL';
     Query OK, 0 rows affected
     ```

     > **注意**
     >
     > 该语句只能在 sys 系统租户下执行。

- 在 sys 系统租户下删除指定的计划缓存。
  
     ```sql
     obclient> ALTER SYSTEM FLUSH PLAN CACHE sql_id='B601070DFC14CB85FDA3766A69A9E1B3' databases='myob1' tenant='tenant1' GLOBAL;
     Query OK, 0 rows affected 
     ```

- 普通租户登录 DBA 清除自己的计划缓存。
  
     ```sql
     obclient> ALTER SYSTEM FLUSH PLAN CACHE sql_id='B601070DFC14CB85FDA3766A69A9E1B3' databases='myob1' GLOBAL;
     Query OK, 0 rows affected 
     ```
