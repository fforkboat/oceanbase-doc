# RPC 连接认证

## 功能简介
<!-- 还在补充-->
本方案支持灰度升级流程（分段平滑升级不影响业务进程），升级过程中，高版本与低版本的 OBServer 是相互兼容的。
即高版本作为客户端能连入低版本服务端；同时低版本作为客户端也能连入高版本服务端。升级后，默认不开启 RPC 认证，需要手动开启。

## 使用示例

此操作过程是基于 SSL 握手开启的 RPC 认证。

1. 需要在安装目录下创建 wallet 文件夹并将证书和私钥文件放入该文件夹。证书和私钥文件包括根证书（ca.pem）、证书（server-cert.pem）、私钥（server-key.pem）三个文件。

   <main id="notice" type='explain'>
     <h4>说明</h4>
     <ul>
     <li>默认安装目录路径：/home/admin/oceanbase。</li>
     <li>wallet 文件夹及文件夹下的文件名不能更改。</li>
     <li>若拥有多台服务器，则每台服务器的安装目录下都需创建 wallet 文件夹，并在该文件夹中放入证书和私钥。</li>
     <li>请确保所需的证书文件就绪后再开启认证，否则，会导致认证失败，进而服务不可用。</li>
     </ul>
   </main>

2. 登录 OceanBase 数据库，依次执行如下命令。

   1. 加载 RPC 认证相关的 SSL 配置。有关开启 SSL 连接的更多信息，请参见 [ssl_client_authentication](../../../7.reference/5.system-reference/1.system-configuration-items/3.cluster-level-configuration-items/194.ssl_client_authentication.md)。

      ```sql
      ALTER SYSTEM SET ssl_client_authentication=True;
      ```

   2. 将客户端的认证方式设置为 `SSL_NO_ENCRYPT`。有关客户端认证的详细信息，请参见 [rpc_client_authentication_method](../../../7.reference/5.system-reference/1.system-configuration-items/3.cluster-level-configuration-items/281.rpc_client_authentication_method.md)。

      ```sql
      ALTER SYSTEM SET rpc_client_authentication_method = 'SSL_NO_ENCRYPT';
      ```

   3. 将服务端的认证方式设置为 `NONE` 或 `SSL_NO_ENCRYPT`。有关服务端认证的详细信息，请参见 [rpc_server_authentication_method](../../../7.reference/5.system-reference/1.system-configuration-items/3.cluster-level-configuration-items/282.rpc_server_authentication_method.md)。

      ```sql
      ALTER SYSTEM SET rpc_server_authentication_method = 'SSL_NO_ENCRYPT';
      ```

      <main id="notice" type='notice'>
       <h4>注意</h4>
       <p>对于安全要求比较高的场景，建议在服务端禁掉 NONE。</p>
      </main>

## 注意事项

* 如果后续需要更改认证方式，只需重新修改设置。
* 开启认证后，只对新建的 RPC 连接起作用，已有的连接不受影响。若想要对已连接的客户端进行认证，需要分批重启 OBServer。
