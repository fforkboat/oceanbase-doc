# Switchover 失败

本节主要介绍 Switchover 失败后的问题排查及定位方法。

## 问题现象

在备库上执行 Switchover 命令时，报错。

## 问题排查

Switchover 失败后，可以先从执行 Switchover 命令后的返回信息初步判断报错原因，也可以通过以下 SQL 确认。其中，value2 列的错误码表示切换失败的原因。

```sql
select * FROM DBA_OB_ROOTSERVICE_EVENT_HISTORY 
where EVENT LIKE "%switchover to%" ORDER BY TIMESTAMP;
```

另外extra_info列包含trace_id信息，如YB420BA2DAD0-00060145D010E699-0-0，可以根据到备租户1号日志流机器上查询rs或者observer日志。

## Switchover 失败，报错 4179

Switchover 失败，报错最常见的错误码为 4179，表示备租户与主租户的日志不同步。首先需要确认是否在主备 Switchover 切换之前，已经检查过备库，发现备库落后主库在很小的区间，例如，查询主、备库的 `SYNC_SCN`，发现两者相差不超过 5s。

查询

## Switchover 相关的错误码汇总

| Switchover 错误码 | 含义                                                    |
|------------------|---------------------------------------------------------|
| 4179              | 备租户与原主租户的日志不同步                              |
| 9088              | 原主租户的角色非 `STANDBY` 或者状态为非 `NORMAL`          |
| 9089              | 原主租户的日志流状态不匹配，可能是备租户切换为主租户异常     |
| 4043              | 登录原主租户的用户名和密码错误或者原主租户已经被删除无法登录 |
| 5260              | 原主租户被锁定，无法查询原主租户                           |