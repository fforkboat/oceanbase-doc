# 告警消息管理

OCP 对告警消息的管理主要包括：告警事件和告警屏蔽。

* **告警事件** ：当某集群处于异常状态，导致用户收到大量告警消息时，如需要对其中部分指定告警项进行查看和统计，可通过告警事件进行管理。

* **告警屏蔽** ：实际生产过程中，当集群出现异常引发告警时，某些导致告警的已知问题可能需要较长时间才能恢复解决，为避免消息打扰，这时可使用告警界面中"告警屏蔽"页签中屏蔽告警的功能，对具体告警项进行短时间屏蔽。

## 查看告警事件

1. 登录 OCP。

2. 在左侧导航栏中单击 **系统管理** **\>** **告警** 。

3. 单击 **告警事件** 进入该页签中。

4. 在查询框中设置查询条件，**告警事件** 列表中将返回所有符合查询条件的告警事件。

   * 支持对告警事件根据告警状态、告警等级、开始时间、结束时间、关键词、应用、告警范围等条件进行精确查找。

   * 单击 **导出告警事件**，可将所有符合查询条件的告警事件导出至本地。

   * 若告警事件配置了消息推送，您可单击 **消息推送** 列的 **未成功** 查看告警事件详情。

   * 若告警事件未配置消息推送，您可单击 **消息推送** 列的 **未配置消息推送** 对其进行告警推送配置。

   ![111](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/ocp/401/%E5%91%8A%E8%AD%A6%E4%BA%8B%E4%BB%B6%E5%88%97%E8%A1%A81.png)

5. 选择需要查看的告警事件，单击告警说明，进入告警事件 **详情** 页。

   **详情** 页中可查看到告警产生的相关信息和该告警通知记录。

   ![05121002](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/ocp/403-cn/%E5%91%8A%E8%AD%A6%E8%AF%A6%E6%83%85.png)

6. 在告警事件详情页中单击右上角 **屏蔽告警**，可对告警消息进行快速屏蔽。

   蔽告警后，在设置的结束时间前，该告警不会在屏蔽时间段内进行上报。

7. 当收到的告警事件过多时，您可按需对告警进行清理。

   1. 在左侧导航栏中单击 系统管理 > 参数管理 。

   2. 在参数列表中搜索 `ocp.alarm.notification.expired-days` 参数，配置告警归档天数。

      参数配置后，超过归档天数的告警消息、告警事件历史记录将被删除，主要包括以下过期数据：

      * ocp2_alarm_notification

      * ocp_alarm_event_notification

      * ocp2_alarm_event_history

      * ocp_alarm_event_record

      * ocp2_alarm_filter （清理的数据写入 `ocp2_alarm_filter_history`， 规则信息不会很多，历史表无需清理）。

   <main id="notice" type='notice'>
   <h4>注意</h4>
   <ul>
   <li>告警清理周期一般不建议配置的过短，可设置几个月清理一次。</li>
   <li>告警不应长时间未恢复而不处理，需注意为用户配置告警推送，用户在收到告警信息后，建议及时进行响应。</li>
   </ul>
   </main>

## 屏蔽告警

在 **告警事件** 页签中可以快速屏蔽告警，但只能屏蔽已上报的告警，且只能规定屏蔽时间，屏蔽的灵活度不够。

以下所示的屏蔽方法可灵活地设置屏蔽条件，将用户不想关注的告警提早屏蔽。屏蔽条件新建好后，系统将会依照屏蔽条件对告警进行屏蔽，若没有立刻执行屏蔽，则建议多等 30 秒。

执行 OceanBase 集群的运维任务时，运维任务会自动设置告警屏蔽。

1. 登录 OCP。

2. 在左侧导航栏中选择 **系统管理** **\>** **告警** 。

3. 在 **屏蔽告警** 页签中单击 **新建屏蔽条件** 。

4. 在 **新建屏蔽条件** 的对话框中配置屏蔽条件。

   |  屏蔽条件  |                                                                                                                  配置说明                                                                                                                  |
   |--------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
   | 应用         | 告警来源。可选择 OceanBase、OBProxy、OCP、OMS 和 日志。      |
   | 屏蔽对象类型  | 依据实际需要，选择屏蔽的范围是全部、租户还是服务器。选项的显示根据应用的选择而有所不同。   |
   | 屏蔽对象      | 依据实际需要，选择具体的告警对象。</br>当选择 **全部对象** 时，您可通过勾选右侧的 **排除对象**，对不需要屏蔽的对象进行排除。   |
   | 屏蔽告警规则  | 选择需要屏蔽的告警，可多选。 |
   | 标签         | 支持对指定的指标进行屏蔽，如慢 SQL 告警，支持对 SQL ID 进行过滤。最多可添加 8 个标签。选。                         |
   | 屏蔽结束时间  | 配置告警屏蔽的结束时间。在结束时间前，被屏蔽的告警不会上报。 <ul><li>可单击方框内自定义结束时间。</li>   <li> 也可单击方框后的时间，如单击 **6 小时** ，系统会将当前时间 + 6 小时填充到方框中。</li></ul>                                 |
   | 每日屏蔽时段 | 打开每日屏蔽时段开关，并配置开始时间和结束时间，系统会在每日的该时间段内对告警进行屏蔽。 |

   当您需要屏蔽某条告警时，可通过添加 标签 对告警进行精确匹配。以屏蔽 **adminMT** 集群下 **meta2** 租户的某条慢 SQL 告警为例，详细配置如下：

   * （选填）添加 **标签名** 为 “ob_cluster”，标签值为集群名称 “adminMT”。
   * （选填）添加 **标签名** 为 “ob_cluster_id”，标签值为集群 ID “15” 。指定集群 ID 用于区分主备集群。
   * （选填）添加 **标签名** 为 “tenant_name”，标签值为租户名称 “meta2”。
   * 添加 **标签名** 为 “sql_id”，标签值为该条慢 SQL 的 SQL ID。

   <main id="notice" type='explain'>
   <h4>说明</h4>
   <p>当告警满足所有标签时，系统才会对其进行屏蔽。其中，上述配置中的 <b>选填</b> 信息是为了帮助您更好地理解和使用标签，在实际使用过程中，您可省略此部分配置。</p>
   </main>

   ![002](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/ocp/401/%E6%96%B0%E5%BB%BA%E5%B1%8F%E8%94%BD%E6%9D%A1%E4%BB%B61.png)

5. 单击 **确定** 。

   系统返回 **屏蔽条件** 列表，且列表中会新增一条数据即新建的屏蔽条件。

   **屏蔽条件** 列表展示全部告警屏蔽配置，默认显示登录用户创建的告警屏蔽配置。

   <main id="notice" type='explain'>
   <h4>说明</h4>
   <ul>
   <li>告警屏蔽条件创建之后，可能不会立刻生效，最多需要 30 秒生效。</li>
   <li>超过屏蔽截止时间 7 天以上的屏蔽配置将不会在 **屏蔽条件** 列表中展示。</li>
   </ul>
   </main>