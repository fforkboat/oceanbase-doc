# 检查集群状态

您可以通过 SQL 命令的方式来检查集群状态。

  <main id="notice" >
    <h4>功能适用性</h4>
    <p>目前社区版 OCP 暂不支持健康巡检功能。</p>
  </main>

## 检查集群状态

### 通过 OCP 查看

1. 登录 OCP，进入 **集群概览** 页面。

2. 在 **集群概览** 页面的 **集群列表** 区域，选择待操作的集群并单击其集群名。

3. 在显示的页面的左侧导航栏上，单击 **健康巡检** 。

4. 在 **巡检结果列表** 中，可查看当前集群的健康状态。

5. 在 **健康巡检** 页面右上侧，单击 **导出巡检报告** ，查看巡检结果。

   **说明**

   **巡检报告** 是将 **巡检结果列表** 内容以 `.html` 格式呈现。

   ![2日常巡检-健康巡检 ](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/5849290461/p310492.png)

   配置功能项如下表所示：

   | **参数** |                            **说明**                            |
   |--------|--------------------------------------------------------------|
   | 巡检模块   | 包括集群、主机、OB_SEVER 和 OB_PROXY。                                 |
   | 巡检指标   | 对集群、主机、OB_SEVER 和 OB_PROXY 的各项指标进行了详细说明，详情请参见下文 **巡检指标** 表格。 |
   | 健康状态   | 包括严重、警告和健康。                                                  |
   | 巡检结果描述 | 对主机、集群、OBProxy、zone、OBServer 等情况进行描述。                        |
   | 巡检时间   | 显示巡检发起时的时间，例如 2020 年 11 月 27 日 17:04:00。                     |

   根据 **巡检指标** 可查看集群指标的健康状态，相关详情如下所示。

   |         **巡检指标**         |                                                                                                                                                                         **子指标项**                                                                                                                                                                         |                                                                                                                                                                                                                                            **巡检结果示例**                                                                                                                                                                                                                                            |
   |--------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
   | cluster_status 集群状态      | operation status：集群运维状态 compaction status：集群合并状态                                                                                                                                                                                                                                                                                                         | 运维状态：运行中，健康 合并状态：不在合并状态，健康                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
   | zone_status zone 状态      | compaction status：zone的合并状态 operation status：zone 的运维状态                                                                                                                                                                                                                                                                                                  | 运维状态 *zone：zone1* zone 状态：创建中，警告   *zone：zone2* zone 状态：运行中，健康    合并状态： *zone：zone1* zone 状态：不在合并中，健康   *zone：zone2* zone 状态：合并中，警告    |
   | alarm 告警 | *Stopped event count：停服级别告警数* Critical event count：严重级别告警数   *Warning event count：警告级别告警数* Caution event count：注意级别告警数   * Reminder event count：提醒级别告警数    | * 停服告警个数：1， 大于 0，严重   *严重告警个数：1，大于 0，严重* 警告告警个数：1，大于 0，警告   * 只显示个数大于 0 的告警级别                                                                                                                                                                                                                                                           |
   | MySQL 自增列                | MySQL 自增列检查                                                                                                                                                                                                                                                                                                                                              | 自增列：表 1.列 1 租户：tenant1，数据库：db1 当前自增列值 1000\>2000，不通过                                                                                                                                                                                                                                                                                                                                                                                                             |
   | 按时间列的分区可用性               | 按时间列的分区可用性检查                                                                                                                                                                                                                                                                                                                                             | 表：表 1 租户：tenant1，数据库：db1 当前表可用分区天数少于 10 天，不通过                                                                                                                                                                                                                                                                                                                                                                                                                    |
   | 序列可用性                    | 序列可用性检查                                                                                                                                                                                                                                                                                                                                                  | 序列：sequence1 租户：tenant1，数据库：db1 当前序列已分配值为1000 \> 800，不通过                                                                                                                                                                                                                                                                                                                                                                                                         |

检查集群合并状态
-----------------------------

### 通过视图查看

可通过 `oceanbase.DBA_OB_MAJOR_COMPACTION` 或 `oceanbase.CDB_OB_MAJOR_COMPACTION` 视图查看所有返回记录中 `merge_status` 的状态。

```sql
obclient> SELECT status FROM oceanbase.DBA_OB_MAJOR_COMPACTION;
```

* 返回结果为 'IDEAL' : 集群合并状态健康。

* 返回结果非 'IDEAL' : 集群合并状态不正常，需对集群进行处理。
